From 5c7c7ed05a09b2c3f01bdaaa93031a53b3d46769 Mon Sep 17 00:00:00 2001
From: Tony Camuso <tcamuso@redhat.com>
Date: Mon, 29 Feb 2016 10:28:10 -0500
Subject: Fixed a minor bug in txt-stat tool

Signed-off-by Ning Sun <ning.sun@intel.com>

Conflicts:

	utils/txt-stat.c
---
 utils/txt-stat.c |   22 ++++++++++++----------
 1 files changed, 12 insertions(+), 10 deletions(-)

diff --git a/utils/txt-stat.c b/utils/txt-stat.c
index fe7cd2c..a449947 100644
--- a/utils/txt-stat.c
+++ b/utils/txt-stat.c
@@ -235,16 +235,18 @@ static void display_tboot_log(void *log_base)
     printf("\t buf:\n");
     /* log->buf is phys addr of buf, which will not match where mmap has */
     /* map'ed us, but since it is always just past end of struct, use that */
-    /* Uncompress tboot log */ 
-    LZ_Uncompress(log_buf, out, log->zip_size);
-    /* log is too big for single printk(), so break it up */
-    /* print out the uncompressed log */
-    for ( unsigned int curr_pos = 0; curr_pos < 32*1024; 
-          curr_pos += sizeof(buf)-1 ) {
-        strncpy(buf, out + curr_pos, sizeof(buf)-1);
-        buf[sizeof(buf)-1] = '\0';
-        printf("%s", buf);
-    }
+    /* to uncompress tboot log */ 
+    if (log->zip_size > 0) {
+        LZ_Uncompress(log_buf, out, log->zip_size);
+        /* log is too big for single printk(), so break it up */
+        /* print out the uncompressed log */
+        for ( unsigned int curr_pos = 0; curr_pos < 32*1024; 
+            curr_pos += sizeof(buf)-1 ) {
+            strncpy(buf, out + curr_pos, sizeof(buf)-1);
+            buf[sizeof(buf)-1] = '\0';
+            printf("%s", buf);
+        }
+    } 
 
     for ( unsigned int curr_pos = log->zip_pos; curr_pos < log->curr_pos;
           curr_pos += sizeof(buf)-1 ) {
-- 
1.7.1

